<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<style>
    #instructions, li {
        color: gray;
    }

    #instructions-inner {
        margin-top: 20px;
    }

    #container {
        position: relative;
    }

    .example-answer {
        color: blue;
    }

    .counterexample-answer {
        color: red;
    }

    #collapse-instructions {
        color: grey;
    }

    .instance {
        border-radius: 15px;
        border: 4px dashed #cee3e9;
        margin-bottom: 10px;
        padding-bottom: 10px;
        padding-left: 40px;
        padding-right: 40px;
        text-align: center;
    }

    .instance-title {
        text-align: center;
    }

    .video {
        display: block;
        height: 360px;
        margin: 10px auto;
    }

    .loading-video {
        position: relative;
        top: 50%;
        text-align: center;
    }

    .video-buttons {
        margin-bottom: 5px;
    }

    .video-button {
        border-radius: 15px;
    }

    .annotate-instructions {
        list-style-type: none;
    }

    .video-relates {
        position: relative;
        text-align: center;
    }

    .question-label {
        font-size: 1.5rem;
    }

    .question {
        font-size: 2rem;
        margin: auto auto 20px auto;
        text-align: center;
    }

    .answer-input {
        border: 2px solid #C2C2C2;
        box-shadow: 1px 1px 4px #EBEBEB;
        display: inline-block;
        padding: 5px;
        font-size: 2rem;
        width: 420px;
        height: 40px;
    }

    .answer-input:hover {
        border: 2px solid black;
    }

    .answer-input::placeholder {
        color: lightgray;
    }

    .answers {
        margin-bottom: 20px;
        text-align: center;
    }

    .answer {
        font-size: 1.5rem;
        margin-bottom: 5px;
        margin-right: 10px;
    }

    .remove-answer {
        margin-left: .25rem;
        color: inherit;
        font-size: 100%;
    }

    .remove-answer:hover {
        color: white;
    }

    .alert-answer {
        margin: auto;
        width: 50%;
        text-align: center;
    }

    .answer-instructions {
        list-style-type: none;
        margin-top: 10px;
        text-align: center;
    }

    .reason-list{
      text-align: left;
      padding-left: 40px;
      border: 0 ;
      width: 100%;
    }

    .description {
      color:black;
    }

    .video-progress-bar {
      -webkit-appearance: none;
      background-color: #bdc3c7;
      border-radius: 10px;
      height: 9px;
      width: 50%;
    }

    .video-progress-bar:focus {
      outline: none;
    }

    #comments {
        border-radius: 15px;
        border: 4px dashed #cee3e9;
    }

    textarea {
      text-align: center;
    }

</style>

<div id="container" class="container">
  <h1 id="top">Video Description</h1>

  <details id="instructions">
    <summary>Instructions</summary>

    <div id="instructions-inner">

      <p>We need help for this Video Description task based on video content (including the audio).
      </p>

      <h3>Basic Instructions</h3>

      <ul>
        <li>You will need to provide video descriptions with regard to the content in the videos.</li>
        <li>You will need to provide at least one description for each video, <b>the more the better</b>.
        </li>
        <li>You will need to identify the source of your description (whether it is based on the scene, or the audio) and classify your description accordingly.
        </li>
        <li>You will need to provide video evidence (video clip) to support your description.
        </li>
      </ul>

      <h3>How To Provide Video Description</h3>

      <ul>
        <li>"Video Description" means one event happens in the video.</li>
        <li>For each video, after you finish one description, you could click the <u>Add one more description for this video</u> button to 
        continue to provide another description for this video. On the contrary, if you want to delete one description, you could click 
        the <u>Delete this Description</u> button.</li>
    </ul>

      <h3>How to identity the Description Category</h3>

        We have some basic categories: <b>Motion, Spatial Relationship, Temporal Relationship, Reasoning, Number, Object, Time, Location, Other.</b>
        <br>
        If your descriptions fall into <b>multiple categories</b>, please <u>check all categories that apply</u>.
      <p>Here are some descriptions under each category:</p>
      <ul>
          <li><b>Motion:</b> The group of soldiers is <span class="example-answer">running</span>.</li>
          <li><b>Spatial Relationship:</b> A truck is driving <span class="example-answer">beside</span> the motorcycle.</li>
          <li><b>Temporal Relationship:</b> A man ignited the firewood <span class="example-answer">before</span> the black smoke rises.</li>
          <li><b>Reasoning:</b> The tornado <span class="example-answer"> causes </span> the driver to change direction.</li>
          <li><b>Number:</b> <span class="example-answer">Two</span> fighters are flying.</li>
          <li><b>Object:</b> The target of the bullet is a <span class="example-answer">dummy</span>.</li>
          <li><b>Time:</b> The missile can fly for <span class="example-answer">half an hour.</span> </li>
          <li><b>Location:</b> The tank is <span class="example-answer"> in the pool</span>.</li>
          <li><b>Other:</b> The man requires the warship to duck.</li>
      </ul>

      <h3>How to provide video evidence</h3>
      <ul>
        <li> You need to provide at least one and up to five video evidences for one description.</li>
        <li> You need to provide both the <b>start point and end point</b> for all the video evidences you identify in the video;</li>
        <li> You could use your mouse or &larr;/&rarr; key to <b>click or drag the process bars</b> of start point and end point. When you click or drag the bar, the above video will change accordingly, so you could locate the points according to the video screen.</li>
        <li> For each video evidence clip, the end point should be <b>greater than zero</b>, and the end point should be greater or equal to the start point.</li>
        <li> The video evidence clips (the time gap between the start point and the end point) should be <span class="example-answer">as short as possible.</span></li>
      </ul>

      <h3>Example</h3>
      
      <div id="example"></div>

      <button type="button" class="btn" id="collapse-instructions" onclick="collapseInstructions()">
        &#x25B2 Collapse instructions
      </button>
    </div>
  </details>

  <hr>

  <crowd-form onsubmit="return checkValid()">
    <div id="instances"></div>

    <div class="form-group">
      <label for="comments">Comments:</label>
      <textarea class="form-control" id="comments" name="comments" rows="10"
                placeholder="Please, write any comment/error/suggestion you have."></textarea>
    </div>

    <crowd-button id="submit-button" form-action="submit" variant="primary">Submit</crowd-button>
  </crowd-form>
</div>

<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
<!--suppress CommaExpressionJS -->
<script type="text/javascript">
  // JS string interpolations clash with the Amazon Mechanical Turk template system, as they both use the syntax ${...}.
  // So we do a trick which is to put the simple string interpolation of variables inside a comma operator expression,
  // which always returns the last operand. For example, if we have to interpolate the variable "i" inside the backticks
  // (`) then we do `${0, i}`. This is basically the minimum we can write as far as we know.
  // Complex expressions usually don't need this. I tried other variants, but it seems that AMT captures spaces and plus
  // signs as valid syntax. The ternary operator is another option (`${1 ? i : 0}`), though more verbose.

  const ENTER_KEY_CODE = 13;
  const BACKSPACE_KEY_CODE = 8;

  const videos = ["https://www.dropbox.com/s/xaw3bbhx5bmahqn/Dan-Robinson_10-clip-0.mp4?raw=1", 
    "${video1}", "${video2}", "${video3}", "${video4}", "${video5}"]
      .map(v => templateWasSubstituted(v) ? v :
       "https://www.dropbox.com/s/xaw3bbhx5bmahqn/Dan-Robinson_10-clip-0.mp4?raw=1");
  // const videos = ["1WsdfOmM5L-7aXjyuxSqouYVkpNxXx4Lt", "${video1}","${video2}"]
  //     .map(v => templateWasSubstituted(v) ? `./video0.mp4` :
  //      "./video1.mp4");

  function templateWasSubstituted(s) {
    return !s.startsWith("${") || !s.endsWith("}");
  }

  // From https://stackoverflow.com/a/6234804/1165181
  function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        // Use single quotes as AMT expands the double quote escaping and gives a syntax error otherwise:
        .replace(/"/g, '&quot;')
        .replace(/'/g, "&#039;");
  }

  function createInstanceElement(i, isExample, title, video) {
    return $(`
        <div class="instance" id="instance-${0, i}">
          <b><h1 class="instance-title">${0, title}</h1></b>
          <div class="video" id="video-${0, i}">
            <video width="65%" src=${0,video} controls> </video>
          </div>
        </br>
          <div class="video-relates">
            <ul class="annotate-instructions">
                <li>
                  Please carefully read the
                <a href="#instructions">instructions</a> before performing the task.
                </li>
                <li>
                  Watch this video while you listen to its <b><u>audio</u></b> (you
                  may need to adjust your <b>device volume</b>).
                </li>
                <li>
                  When the video ends, <b>do not</b> click on any other video. Place your mouse on the video, control buttons will then appear.
                </li>
              </ul>
          </div>
            
          <hr>

          <div id="inner-questions-${0,i}"></div>

        </div>`);
  }


  function createQuestionElement(i, j, isExample, isDeletable, video) {
    return $(`
        <div class="inner-question" name="inner-question-${0,i}" id="inner-question-${0,i}-${0,j}">
          ${j==0? "":"</br><hr style=\"border: 2px dashed #cee3e9;\">"}

          ${ isDeletable?`<button type="button" class="btn btn-danger" 
          id="delete-question-${0,i}-${0,j}" ${isExample? "disabled":""} > click here to <u>Delete</u> this Description </button>`:""}

          <h3> Video${isExample? "-Example":`-${0,i}`} Description-${0,j+1} </h3>
          
          <br>
          <div class="form-group">
            <h4>Your Video Description:</h4>
             <textarea class="form-control" id="question-input-${0, i}-${0,j}" name="question-input-${0, i}-${0,j}" 
              rows="2" placeholder="Please type your description here" 
              ${isExample? "disabled" :""}>${isExample? "The landspout bends toward left.":""}</textarea></br>
          </div>

          <hr>

          <div>
            <h4>What is your description based on: (Check all that apply):</h4>
            <br>
            <div>
              <input type="checkbox" name="question-based-${0, i}-${0,j}" id="question-based-scene-${0, i}-${0,j}" 
              value="scene"/ ${isExample? "disabled checked":""}>
              <label for="question-based-scene-${0, i}-${0,j}">Scene </label>
              <input type="checkbox" name="question-based-${0, i}-${0,j}" id="question-based-audio-${0, i}-${0,j}" 
              value="audio"/ ${isExample? "disabled":""}>
              <label for="question-based-audio-${0, i}-${0,j}">Audio </label>
            </div>
          </div>

          <hr>

          <div>
            <h4>How do you classify your description: (Check all that apply):</h4>
            <br>
            <div>
              <input type="checkbox" name="how-${0, i}-${0,j}" id="how-motion-${0,i}-${0,j}" 
              value="Motion" ${isExample? "disabled":""}>
              <label for="how-motion-${0,i}-${0,j}">Motion</label>
              <input type="checkbox" name="how-${0,i}-${0,j}" id="how-spatial-${0,i}-${0,j}" 
              value="Spatial relationship" ${isExample? "disabled":""}>
              <label for="how-spatial-${0,i}-${0,j}">Spatial relationship</label>
              <input type="checkbox" name="how-${0,i}-${0,j}" id="how-temporal-${0,i}-${0,j}" 
              value="Temporal relationship" ${isExample? "disabled":""}>
              <label for="how-temporal-${0,i}-${0,j}">Temporal relationship</label>
              <input type="checkbox" name="how-${0,i}-${0,j}" id="how-reasoning-${0,i}-${0,j}" 
              value="Reasoning" ${isExample? "disabled":""}>
              <label for="how-reasoning-${0,i}-${0,j}">Reasoning</label>
              <br>
              <input type="checkbox" name="how-${0,i}-${0,j}" id="how-number-${0,i}-${0,j}" 
              value="Number" ${isExample? "disabled":""}>
              <label for="how-number-${0,i}-${0,j}">Number</label>
              <input type="checkbox" name="how-${0,i}-${0,j}" id="how-object-${0,i}-${0,j}" 
              value="Object" ${isExample? "disabled":""}>
              <label for="how-object-${0,i}-${0,j}">Object</label>
              <input type="checkbox" name="how-${0,i}-${0,j}" id="how-time-${0,i}-${0,j}" 
              value="Time" ${isExample? "disabled":""}>
              <label for="how-time-${0,i}-${0,j}">Time</label>
              <input type="checkbox" name="how-${0,i}-${0,j}" id="how-location-${0,i}-${0,j}" 
              value="Location" ${isExample? "disabled":""}>
              <label for="how-location-${0,i}-${0,j}">Location</label>
              <input type="checkbox" name="how-${0,i}-${0,j}" id="how-other-${0,i}-${0,j}" 
              value="Other" ${isExample? "checked disabled":""}>
              <label for="how-other-${0,i}-${0,j}">Other</label>
            </div>
            <textarea class="form-control" id="other-${0,i}-${0,j}" name="other-${0,i}-${0,j}" rows="1"
                placeholder="If select 'Other', write down what type your description belongs to (N/A if cannot come up with any specific type)"
                ${isExample? "disabled":""}>${isExample? "Direction":""}</textarea></br>
          </div>

          <hr>

          <div class="video-evidence" id="video-evidence-${0,i}-${0,j}">
            <h4>Locate up to five video evidences to support your description:</h4>
            <video width="50%" src=${0,video} id="refer-video-${0,i}-${0,j}" controls> </video>
            <ur class="annotate-instructions">
              <li> You need to provide at least one and up to five video evidences for one description.</li>
              <li> You need to provide both the <b>start point and end point</b> for all the video evidences you identify in the video;</li>
              <li> You could use your mouse or &larr;/&rarr; key to <b>click or drag the process bars</b> of start point and end point.</li>
              <li> For each video evidence clip, the end point should be <b>greater than zero</b>, and the end point should be greater or equal to the start point.</li>
              <li> The video evidence clips (the time gap between the start point and the end point) should be <b>as short as possible.</b></li>
            </ur>

            <div id="video-bars-${0,i}-${0,j}"></div>
            
          </div>
          <hr>

          <div class="alert alert-warning alert-answer" id="alert-${0,i}-${0,j}"></div></br>

         <button type="button" name="create-question-${0,i}" class="btn btn-info" id="create-question-${0,i}-${0,j}" ${isExample? "disabled":""} >
          click here to <font size="4"><b>Add one more<b></font> description for this video</button>
        </div>`
    )
  }

  function createBarElement(i, j, k, isExample, isDeletable, isAddable){
    return $(`
    <div class="video-bar" name="video-bar-${0, i}-${0, j}" id="video-bar-${0, i}-${0, j}-${0, k}">
      ${isDeletable? "<hr>":""}

      <label for="start-bar-${0, i}-${0, j}-${0, k}">Start point: </label> <input type="range" class="video-progress-bar" name="start-bar-${0, i}-${0, j}-${0, k}" id="start-bar-${0, i}-${0, j}-${0, k}"
        ${isExample? "disabled value=20.56" :"value=0"} max="100" step="0.08"><br>
      <label for="end-bar-${0, i}-${0, j}-${0, k}">End &nbsp;point: </label> <input type="range" class="video-progress-bar" name="end-bar-${0, i}-${0, j}-${0, k}" id="end-bar-${0, i}-${0, j}-${0, k}" 
        ${isExample? "disabled value=20.96" :"value=0"} max="100" step="0.08"><br>
      
      ${ isDeletable?`<button type="button" class="btn btn-danger" 
        name="delete-bar-${0,i}-${0, j}" id="delete-bar-${0,i}-${0, j}-${0,k}" style=" height:30px; padding-top:4px;" ${isExample? "disabled":""} > Click here to <u>Delete</u> this video evidence</button>`:""}
      ${ isAddable?`<button type="button" class="btn btn-success"
        name="create-bar-${0,i}-${0, j}" id="create-bar-${0,i}-${0, j}-${0,k}" style=" height:30px; padding-top:4px;" ${isExample? "disabled":""} > Click here to <font size="3"><b>Add one more</b></font> video evidence</button>`:""}
    </div>
    `);
  }

  function insertBarElement(i, j, k, isExample){
    const isDeletable = k > 0;
    const isAddable = Array.from($(`[name="video-bar-${0, i}-${0, j}"]`)).length <= 3;
    createBarElement(i, j, k, isExample, isDeletable, isAddable).appendTo(`#video-bars-${0, i}-${0, j}`);
    $(`#create-bar-${0, i}-${0, j}-${0,k}`).click(() => {
      const $videobarsarray = Array.from($(`[name="video-bar-${0, i}-${0, j}"]`));
      insertBarElement(i,j,parseInt($videobarsarray[$videobarsarray.length-1].id.split("-")[4]) + 1, isExample);
      document.getElementById(`create-bar-${0, i}-${0, j}-${0,k}`).disabled = true;
      checkValidationAlerts(i,j);
      });
    $(`#delete-bar-${0, i}-${0, j}-${0, k}`).click(() => {
      if (confirm(`Do you really want to delete this video evidence?`)==true){
        const $createbarsarray = Array.from($(`[name="create-bar-${0, i}-${0, j}"]`));
        if($createbarsarray[$createbarsarray.length-1].id.split("-")[4] == k){ // delete last addable bar
          $createbarsarray[$createbarsarray.length-2].disabled = false;
        }
        else{
          if($createbarsarray[$createbarsarray.length-1].disabled == true){ // activate last addable bar
            $createbarsarray[$createbarsarray.length-1].disabled = false;
          }
        }

        const obj =  document.getElementById(`video-bar-${0, i}-${0, j}-${0,k}`);
        const objparent = obj.parentNode;
        objparent.removeChild(obj);
      }
      checkValidationAlerts(i,j);
    });
    setUpVideoListeners();
  }

  function insertQuestionElement(i, j, isExample, video){
    const isDeletable = j > 0;
    createQuestionElement(i, j, isExample, isDeletable, video).appendTo(`#inner-questions-${0,i}`);
    insertBarElement(i, j, 0, isExample);
    $(`#create-question-${0,i}-${0,j}`).click(() => {
      const $questionsarray = Array.from($(`[name="inner-question-${0,i}"]`));
      insertQuestionElement(i, parseInt($questionsarray[$questionsarray.length-1].id.split("-")[3]) + 1, isExample, video);
      document.getElementById(`create-question-${0,i}-${0,j}`).disabled = true;
      });
    $(`#delete-question-${0,i}-${0,j}`).click(() => {
      if (confirm(`Do you really want to delete Video-${0,i} Question-${0,j+1} ?`)==true){
        const $createquestionsarray = Array.from($(`[name="create-question-${0,i}"]`));
        if($createquestionsarray[$createquestionsarray.length-1].id.split("-")[3] == j){ // delete last addable question
          $createquestionsarray[$createquestionsarray.length-2].disabled = false;
        }
        else{
          if($createquestionsarray[$createquestionsarray.length-1].disabled == true){ // activate last addable question
            $createquestionsarray[$createquestionsarray.length-1].disabled = false;
          }
        }

        const obj =  document.getElementById(`inner-question-${0,i}-${0,j}`);
        const objparent = obj.parentNode;
        objparent.removeChild(obj);
      }
    });
    setUpInputListeners();
    setUpVideoListeners();
  }

  function createInstances() {
    videos.forEach((video, i) => {
      const isExample = i === 0;
      const title = isExample ? "Example" : `Video ${0, i}`;
      const parentId = isExample ? "example" : "instances";
      createInstanceElement(i, isExample, title, video).appendTo(`#${0, parentId}`);
      insertQuestionElement(i, 0, isExample, video);
    });
  }

  function collapseInstructions() {
    $("#instructions").removeAttr("open");
    window.location = "#top";
  }

  function questionCompleted(i,j) {
    const i_value = document.getElementById(`question-input-${0,i}-${0,j}`).value;
    return i_value != null && i_value != "";
  }

  function basedCompleted(i,j){
    return $(`[name="question-based-${0,i}-${0,j}"]:checked`).length > 0;
  }

  function howCompleted(i,j) {
    return $(`[name="how-${0,i}-${0,j}"]:checked`).length > 0;
  }

  function evidenceCompleted(i,j,k) {
    const $startbar_value = parseFloat(document.getElementById(`start-bar-${0, i}-${0, j}-${0, k}`).value);
    const $endbar_value = parseFloat(document.getElementById(`end-bar-${0, i}-${0, j}-${0, k}`).value);
    return ($endbar_value > 0) && ($startbar_value <= $endbar_value);
  }

  function evidencesCompleted(i,j) {
    return Array.from($(`[name="video-bar-${0, i}-${0, j}"]`)).map((eveele,) => {
      const k = eveele.id.split("-")[4];
      return evidenceCompleted(i,j,k);
    }).every(Boolean);
  }

  function blankCompleted(i,j) {
    return  questionCompleted(i,j) && basedCompleted(i,j) && howCompleted(i,j) && evidencesCompleted(i,j);
  }

  function videoCompleted(i) {
    return Array.from($(`[name="inner-question-${0, i}"]`)).map((queele,_) => {
      const j = queele.id.split("-")[3];
      return blankCompleted(i,j);
    }).every(Boolean);
  }

  function checkValid() {
    const completed = videos.map((_, i) => {
      const completi = videoCompleted(i);
      Array.from($(`[name="inner-question-${0, i}"]`)).map((queele,_) => {
        const j = queele.id.split("-")[3];
        const message1 = "Please type into your description.";
        const message2 = "Please choose at least one option."
        const message3 = "Please choose at least one option.";
        const message6 = "Please finish the video evidence part.\nMake sure the end time > 0.\nMake sure the end time >= the start time.";
        document.getElementById(`question-input-${0,i}-${0,j}`).setCustomValidity(questionCompleted(i,j)? "" : message1);
        document.getElementById(`question-based-scene-${0,i}-${0,j}`).setCustomValidity(basedCompleted(i,j)? "" : message2);
        document.getElementById(`how-motion-${0,i}-${0,j}`).setCustomValidity(howCompleted(i,j)? "" : message3);
        Array.from($(`[name="video-bar-${0, i}-${0, j}"]`)).map((eveele,) => {
          const k = eveele.id.split("-")[4];
          document.getElementById(`start-bar-${0, i}-${0, j}-${0, k}`).setCustomValidity(evidenceCompleted(i, j, k)? "" : message6);
        });
      });
      return completi;
    }).every(Boolean);

    document.getElementsByTagName("form")[0].reportValidity();

    return completed;
  }

  function checkValidationAlerts(i,j) {
    const $errorMessage = $(`#alert-${0,i}-${0,j}`);
    if (blankCompleted(i,j)) {
      $errorMessage.fadeOut("fast");
    } else {
      $errorMessage.text("Please finish above fill-in and classification tasks.").fadeIn();
    }
  }

  function setUpInputListeners() 
  {
    videos.forEach((_, i) => {
      Array.from($(`[name="inner-question-${0, i}"]`)).map((queele,_) => {
        const j = queele.id.split("-")[3];
        $(`[name="question-input-${0,i}-${0, j}"]`).keyup(e => 
          {
            if (e.keyCode != ENTER_KEY_CODE && e.keyCode != BACKSPACE_KEY_CODE){
              document.getElementById(`question-input-${0, i}-${0, j}`).setCustomValidity("");
              $(document.getElementById(`question-input-${0, i}-${0, j}`)).removeClass("is-invalid");
            }
            checkValidationAlerts(i,j);
          });

        Array.from($(`[name="question-based-${0, i}-${0, j}"]`)).forEach(rease => 
        { $(rease).click(e => 
          {
            document.getElementById(`question-based-scene-${0, i}-${0, j}`).setCustomValidity("");
            $(document.getElementById(`question-based-scene-${0, i}-${0, j}`)).removeClass("is-invalid");
            checkValidationAlerts(i,j);
          });
        });

        Array.from($(`[name="how-${0, i}-${0, j}"]`)).forEach(rease => 
        { $(rease).click(e => 
          {
            document.getElementById(`how-motion-${0, i}-${0, j}`).setCustomValidity("");
            $(document.getElementById(`how-motion-${0, i}-${0, j}`)).removeClass("is-invalid");
            checkValidationAlerts(i,j);
          });
        });

        checkValidationAlerts(i,j);
      });
    });
  }

  function setUpVideoListeners() {
    videos.forEach((_, i) => {
      Array.from($(`[name="inner-question-${0, i}"]`)).map((queele,_) => {
        const j = queele.id.split("-")[3];
        Array.from($(`[name="video-bar-${0, i}-${0, j}"]`)).map((eveele,) => {
          const k = eveele.id.split("-")[4];
          const $videoi = document.getElementById(`refer-video-${0, i}-${0, j}`);
          const $startbari = document.getElementById(`start-bar-${0, i}-${0, j}-${0, k}`);
          const $endbari = document.getElementById(`end-bar-${0, i}-${0, j}-${0, k}`);

          $($startbari).mousedown(e =>{
            $videoi.pause();
            $startbari.setCustomValidity("");
            $($startbari).removeClass("is-invalid");
            $startbari.onmousemove=function(){
              $videoi.currentTime = parseFloat($startbari.value) / 100 * parseFloat($videoi.duration);
            }
            $startbari.onmouseup=function(){
              $videoi.currentTime = parseFloat($startbari.value) / 100 * parseFloat($videoi.duration);
              checkValidationAlerts(i,j);
              $startbari.onmouseup=null;
              $startbari.onmousemove=null;
            }
            checkValidationAlerts(i,j);
          });
          $($startbari).keydown(e => {
            if (e.keyCode === 37 || e.keyCode === 39){
              $videoi.currentTime = parseFloat($startbari.value) / 100 * parseFloat($videoi.duration);
              $startbari.setCustomValidity("");
              $($startbari).removeClass("is-invalid");
            }
            checkValidationAlerts(i,j);
          });
        
          $($endbari).mousedown(e =>{
            $videoi.pause();
            $startbari.setCustomValidity("");
            $($startbari).removeClass("is-invalid");
            $endbari.onmousemove=function(){
              $videoi.currentTime = parseFloat($endbari.value) / 100 * parseFloat($videoi.duration);
            }
            $endbari.onmouseup=function(){
              $videoi.currentTime = parseFloat($endbari.value) / 100 * parseFloat($videoi.duration);
              checkValidationAlerts(i,j);
              $endbari.onmousemove=null;
              $endbari.onmouseup=null;
            }
            checkValidationAlerts(i,j);
          });
          $($endbari).keydown(e => {
            if (e.keyCode === 37 || e.keyCode === 39){
              $videoi.currentTime = parseFloat($endbari.value) / 100 * parseFloat($videoi.duration);
              $startbari.setCustomValidity("");
              $($startbari).removeClass("is-invalid");
            }
            checkValidationAlerts(i,j);
          });
        });
      });
    });
  }

  function onDomContentLoaded() {
    createInstances();
    setUpInputListeners();
    setUpVideoListeners();
  }

  function main() {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", onDomContentLoaded);
    } else {
      onDomContentLoaded();
    }
  }

  main();
</script>
