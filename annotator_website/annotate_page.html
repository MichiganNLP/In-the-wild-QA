<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<style>
    #instructions, li {
        color: gray;
    }

    #instructions-inner {
        margin-top: 20px;
    }

    #container {
        position: relative;
    }

    .example-answer {
        color: blue;
    }

    .counterexample-answer {
        color: red;
    }

    #collapse-instructions {
        color: grey;
    }

    .instance {
        border-radius: 15px;
        border: 4px dashed #cee3e9;
        margin-bottom: 10px;
        padding-bottom: 10px;
        padding-left: 40px;
        padding-right: 40px;
        text-align: center;
    }

    .instance-title {
        text-align: center;
    }

    .video {
        display: block;
        height: 360px;
        margin: 10px auto;
    }

    .loading-video {
        position: relative;
        top: 50%;
        text-align: center;
    }

    .video-buttons {
        margin-bottom: 5px;
    }

    .video-button {
        border-radius: 15px;
    }

    .annotate-instructions {
        list-style-type: none;
    }

    .video-relates {
        position: relative;
        text-align: center;
    }

    .question-label {
        font-size: 1.5rem;
    }

    .question {
        font-size: 2rem;
        margin: auto auto 20px auto;
        text-align: center;
    }

    .answer-input {
        border: 2px solid #C2C2C2;
        box-shadow: 1px 1px 4px #EBEBEB;
        display: inline-block;
        padding: 5px;
        font-size: 2rem;
        width: 420px;
        height: 40px;
    }

    .answer-input:hover {
        border: 2px solid black;
    }

    .answer-input::placeholder {
        color: lightgray;
    }

    .answers {
        margin-bottom: 20px;
        text-align: center;
    }

    .answer {
        font-size: 1.5rem;
        margin-bottom: 5px;
        margin-right: 10px;
    }

    .remove-answer {
        margin-left: .25rem;
        color: inherit;
        font-size: 100%;
    }

    .remove-answer:hover {
        color: white;
    }

    .alert-answer {
        margin: auto;
        width: 50%;
        text-align: center;
    }

    .answer-instructions {
        list-style-type: none;
        margin-top: 10px;
        text-align: center;
    }

    .reason-list{
      text-align: left;
      padding-left: 40px;
      border: 0 ;
      width: 100%;
    }

    .description {
      color:black;
    }

    .video-progress-bar {
      -webkit-appearance: none;
      background-color: #bdc3c7;
      border-radius: 10px;
      height: 9px;
      width: 50%;
    }

    .video-progress-bar:focus {
      outline: none;
    }

    #comments {
        border-radius: 15px;
        border: 4px dashed #cee3e9;
    }

    textarea {
      text-align: center;
    }

</style>

<div id="container" class="container">
  <h1 id="top">Video Question Answering</h1>

  <details id="instructions">
    <summary>Instructions</summary>

    <div id="instructions-inner">

      <p>We need help for this Video QA task based on video content (including the audio).
      </p>

      <h3>Basic Instructions</h3>

      <ul>
        <li>You will need to provide questions with regard to the content in the videos. Please also look at the text description for the video if the description exists.
        </li>
            
        <li>You will need to identify the source of your question (whether it is based on the scene, audio, or text description) and classify your question accordingly.
        </li>

        <li>You will need to provide the correct answer to the question you asked, as supported by the content in the video.
        </li>

        <li>You will need to provide video evidence (video clip) to support your question and answer.
        </li>
            
      </ul>

      <h3>How To Ask Your Question</h3>

      Questions you ask should utilize the <b>professional terminologies</b> in the text description if possible.

      <ul>
        <li>An example of using terminology is as follows:</li>
        <iframe src="https://drive.google.com/file/d/1q9-aoCsKTzXL5asNNJ8wNaJDmob5LWrG/preview" width="640" height="480" allow="autoplay"></iframe>
        <ul>
            <li><b>Text description:</b> US military <span class="example-answer">M1 Abrams tanks</span> ... </li>
            <li><b>Your Question:</b> What is the target of the <span class="example-answer">M1 Abrams tank</span> after it gets close to the river?</li>
        </ul>

      </ul>

      <h3>How to identity the Question Category</h3>

        We have some basic categories: <b>Motion, Spatial Relationship, Temporal Relationship, Reasoning, Number, Object, Time, Location, Other.</b>
        <br>
        If your questions fall into <b>multiple categories</b>, please <u>check all categories that apply</u>.
      <p>Here are some questions under each category:</p>
      <ul>
          <li><b>Motion:</b> What are the group of soldiers <span class="example-answer">doing</span>?</li>
          <li><b>Spatial Relationship:</b> What is driving <span class="example-answer">beside</span> the motorcycle?</li>
          <li><b>Temporal Relationship:</b> What happens <span class="example-answer">before</span> the black smoke rises?</li>
          <li><b>Reasoning:</b> <span class="example-answer">What makes</span> changing between targets <span class="example-answer">possible</span> for the missile?</li>
          <li><b>Number:</b> <span class="example-answer">How many</span> fighters are flying?</li>
          <li><b>Object:</b> <span class="example-answer">What is the target</span> of the bullet?</li>
          <li><b>Time:</b> <span class="example-answer">How long</span> can the missile fly?</li>
          <li><b>Location:</b> <span class="example-answer">Where</span> is the tank?</li>
          <li><b>Other:</b> What does the man require the warship to do?</li>
      </ul>

      <h3>How to provide video evidence</h3>
      <ur>
        <li> You need to provide at least one and up to five video evidences for one question.</li>
        <li> You need to provide both the <b>start point and end point</b> for all the video evidences you identify in the video;</li>
        <li> You could use your mouse or &larr;/&rarr; key to <b>click or drag the process bars</b> of start point and end point. When you click or drag the bar, the above video will change accordingly, so you could locate the points according to the video screen.</li>
        <li> For each video evidence clip ,the end point should be <b>greater than zero</b>, and the end point should be greater or equal to the start point.</li>
        <li> The video evidence clips (the time gap between the start point and the end point) should be <span class="example-answer">as short as possible.</span></li>
      </ur>

      <h3>HIT Acceptance</h3>

      Your HIT will be accepted based on:
      <ul>
          <li>How well your question <u>relates to the video content</u></li>
          <li>Whether your question <u>involves professional terms provided in the text description</u> if possible</li>
          <li>How well your video evidence supports your question and answer.</li>
      </ul>

      <h3>Example</h3>
      
      <div id="example"></div>

      <button type="button" class="btn" id="collapse-instructions" onclick="collapseInstructions()">
        &#x25B2 Collapse instructions
      </button>
    </div>
  </details>

  <hr>

  <crowd-form onsubmit="return checkValid()">
    <div id="instances"></div>

    <div class="form-group">
      <label for="comments">Comments:</label>
      <textarea class="form-control" id="comments" name="comments" rows="10"
                placeholder="Please, write any comment/error/suggestion you have."></textarea>
    </div>

    <crowd-button id="submit-button" form-action="submit" variant="primary">Submit</crowd-button>
  </crowd-form>
</div>

<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
<!--suppress CommaExpressionJS -->
<script type="text/javascript">
  // JS string interpolations clash with the Amazon Mechanical Turk template system, as they both use the syntax ${...}.
  // So we do a trick which is to put the simple string interpolation of variables inside a comma operator expression,
  // which always returns the last operand. For example, if we have to interpolate the variable "i" inside the backticks
  // (`) then we do `${0, i}`. This is basically the minimum we can write as far as we know.
  // Complex expressions usually don't need this. I tried other variants, but it seems that AMT captures spaces and plus
  // signs as valid syntax. The ternary operator is another option (`${1 ? i : 0}`), though more verbose.

  const ENTER_KEY_CODE = 13;
  const BACKSPACE_KEY_CODE = 8;

  // const videos = ["1WsdfOmM5L-7aXjyuxSqouYVkpNxXx4Lt", "${video1}", "${video2}", "${video3}", "${video4}", "${video5}"]
  //     .map(v => templateWasSubstituted(v) ? `https://drive.google.com/file/d/${0,v}/preview` :
  //      "./video0.mp4");
  const videos = ["1WsdfOmM5L-7aXjyuxSqouYVkpNxXx4Lt", "${video1}", "${video2}"]
      .map(v => templateWasSubstituted(v) ? `./video0.mp4` :
       "./video1.mp4");
  const descriptions = ["A storm produces multiple <span class=\"example-answer\">landspout</span> tornadoes in far \
  eastern Colorado, north of Siebert. <span class=\"example-answer\">Landspouts</span> are a weaker type of tornado \
  caused by a storm updraft stretching low-level vorticity on a boundary.  Copyright Dan Robinson. http://stormhighway.com",
  "${description1}","${description2}", "${description3}", "${description4}", "${description5}"]
      .map(d => templateWasSubstituted(d) ? d : "N/A");


  function templateWasSubstituted(s) {
    return !s.startsWith("${") || !s.endsWith("}");
  }

  // From https://stackoverflow.com/a/6234804/1165181
  function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        // Use single quotes as AMT expands the double quote escaping and gives a syntax error otherwise:
        .replace(/"/g, '&quot;')
        .replace(/'/g, "&#039;");
  }

  function createInstanceElement(i, isExample, title, video, description, showNextButton) {
    return $(`
        <div class="instance" id="instance-${0, i}">
          <h2 class="instance-title">${0, title}</h2>
          <div class="video" id="video-${0, i}">
            <video width="65%" src=${0,video} controls> </video>
          </div>
        </br>
          <div class="video-relates">
            <ul class="description">
                <big><b> Text Description </b></big>: ${0,description}
            </ul>
            <ul class="annotate-instructions">
                <li>
                  Please carefully read the
                <a href="#instructions">instructions</a> before performing the task.
                </li>
                <li>
                  Watch this video while you listen to its <b><u>audio</u></b> (you
                  may need to adjust your <b>device volume</b>).
                </li>
                <li>
                  When the video ends, <b>do not</b> click on any other video. Place your mouse on the video, control buttons will then appear.
                </li>
                <li>In addition to the video, please also consider the text description when performing the task.</li>
              </ul>
          </div>
            
          <hr>

          <div class="form-group">
            <h4>Your Question:</h4>
             <textarea class="form-control" id="question-input-${0, i}" name="question-input-${0, i}" 
              rows="2" placeholder="Please type your question here" 
              ${isExample? "disabled" :""}>${isExample? "Which direction does the landspout bend towards?":""}</textarea></br>
          </div>

          <hr>

          <div>
            <h4>What is your question based on: (Check all that apply):</h4>
            <br>
            <div>
              <input type="checkbox" name="question-based-${0, i}" id="question-based-scene-${0, i}" 
              value="scene"/ ${isExample? "disabled checked":""}>
              <label for="question-based-scene-${0, i}">Scene </label>
              <input type="checkbox" name="question-based-${0, i}" id="question-based-audio-${0, i}" 
              value="audio"/ ${isExample? "disabled":""}>
              <label for="question-based-audio-${0, i}">Audio </label>
              <input type="checkbox" name="question-based-${0, i}" id="question-based-video_description-${0, i}" 
              value="video_description"/ ${isExample? "disabled checked":""}>
              <label for="question-based-video_description-${0, i}">Text description</label>
            </div>
          </div>

          <hr>

          <div>
            <h4>How do you classify your question: (Check all that apply):</h4>
            <br>
            <div>
              <input type="checkbox" name="how-${0, i}" id="how-motion-${0, i}" 
              value="Motion" ${isExample? "disabled":""}>
              <label for="how-motion-${0, i}">Motion</label>
              <input type="checkbox" name="how-${0, i}" id="how-spatial-${0, i}" 
              value="Spatial relationship" ${isExample? "disabled":""}>
              <label for="how-spatial-${0, i}">Spatial relationship</label>
              <input type="checkbox" name="how-${0, i}" id="how-temporal-${0, i}" 
              value="Temporal relationship" ${isExample? "disabled":""}>
              <label for="how-temporal-${0, i}">Temporal relationship</label>
              <input type="checkbox" name="how-${0, i}" id="how-reasoning-${0, i}" 
              value="Reasoning" ${isExample? "disabled":""}>
              <label for="how-reasoning-${0, i}">Reasoning</label>
              <br>
              <input type="checkbox" name="how-${0, i}" id="how-number-${0, i}" 
              value="Number" ${isExample? "disabled":""}>
              <label for="how-number-${0, i}">Number</label>
              <input type="checkbox" name="how-${0, i}" id="how-object-${0, i}" 
              value="Object" ${isExample? "disabled":""}>
              <label for="how-object-${0, i}">Object</label>
              <input type="checkbox" name="how-${0, i}" id="how-time-${0, i}" 
              value="Time" ${isExample? "disabled":""}>
              <label for="how-time-${0, i}">Time</label>
              <input type="checkbox" name="how-${0, i}" id="how-location-${0, i}" 
              value="Location" ${isExample? "disabled":""}>
              <label for="how-location-${0, i}">Location</label>
              <input type="checkbox" name="how-${0, i}" id="how-other-${0, i}" 
              value="Other" ${isExample? "checked disabled":""}>
              <label for="how-other-${0, i}">Other</label>
            </div>
            <textarea class="form-control" id="other-${0, i}" name="other-${0, i}" rows="1"
                placeholder="If select 'Other', write down what type your question belongs to (N/A if cannot come up with any specific type)"
                ${isExample? "disabled":""}>${isExample? "Direction":""}</textarea></br>
          </div>
          <hr>

          <div class="form-group">
            <h4>Correct Answer:<h4>
             <textarea class="form-control" id="correct-answer-${0, i}" name="correct-answer-${0, i}" 
              rows="1" placeholder="Correct Answer" 
              ${isExample? "disabled" :""}>${isExample? "Left":""}</textarea></br>
            <h5>Please suggest how confident you are with your answer:</h5>
            <br>
            <div>
              <input type="radio" name="confidence-${0, i}" id="confidence-veryhigh-${0, i}" 
              value="very_high" ${isExample? "disabled":""} />
              <label for="confidence-veryhigh-${0, i}">Very High Confidence</label>
              <input type="radio" name="confidence-${0, i}" id="confidence-high-${0, i}" 
              value="high" ${isExample? "checked disabled":""} />
              <label for="confidence-high-${0, i}">High Confidence</label>
              <input type="radio" name="confidence-${0, i}" id="confidence-moderate-${0, i}" 
              value="moderate" ${isExample? "disabled":""} />
              <label for="confidence-moderate-${0, i}">Moderate Confidence</label>
              <input type="radio" name="confidence-${0, i}" id="confidence-low-${0, i}" 
              value="low" ${isExample? "disabled":""} />
              <label for="confidence-low-${0, i}">Low Confidence</label>
              <input type="radio" name="confidence-${0, i}" id="confidence-verylow-${0, i}" 
              value="very_low" ${isExample? "disabled":""} />
              <label for="confidence-verylow-${0, i}">Very Low Confidence</label>
            </div>
          </div>

          <hr>

          <div class="video-evidence" id="video-evidence-${0, i}">
            <h4>Locate up to five video evidences to support your question and answer:</h4>
            <video width="50%" src=${0,video} id="refer-video-${0, i}" controls> </video>
            <ur class="annotate-instructions">
              <li> You need to provide at least one and up to five video evidences for one question.</li>
              <li> You need to provide both the <b>start point and end point</b> for all the video evidences you identify in the video;</li>
              <li> You could use your mouse or &larr;/&rarr; key to <b>click or drag the process bars</b> of start point and end point.</li>
              <li> For each video evidence clip ,the end point should be <b>greater than zero</b>, and the end point should be greater or equal to the start point.</li>
              <li> The video evidence clips (the time gap between the start point and the end point) should be <b>as short as possible.</b></li>
            </ur>

            <div id="video-bars-${0,i}"></div>

          </div>
          <hr>

          <div class="alert alert-warning alert-answer" id="alert-${0, i}"></div></br>

          ${showNextButton ? `<button type="button" class="btn btn-info" id="next-instance-${0, i}">
                                Go to the next Blank</button>` : ""}
        </div>`);
  }

  function createBarElement(i, k, isExample, isDeletable, isAddable){
    return $(`
    <div class="video-bar" name="video-bar-${0, i}" id="video-bar-${0, i}-${0, k}">
      ${isDeletable? "<hr>":""}

      <label for="start-bar-${0, i}-${0, k}">Start point: </label> <input type="range" class="video-progress-bar" name="start-bar-${0, i}-${0, k}" id="start-bar-${0, i}-${0, k}"
        ${isExample? "disabled value=20.56" :"value=0"} max="100" step="0.08"><br>
      <label for="end-bar-${0, i}-${0, k}">End &nbsp;point: </label> <input type="range" class="video-progress-bar" name="end-bar-${0, i}-${0, k}" id="end-bar-${0, i}-${0, k}" 
        ${isExample? "disabled value=20.96" :"value=0"} max="100" step="0.08"><br>
      
      ${ isDeletable?`<button type="button" class="btn btn-danger" 
        name="delete-bar-${0,i}" id="delete-bar-${0,i}-${0,k}" style=" height:30px; padding-top:4px;" ${isExample? "disabled":""} > Click here to <u>Delete</u> this video evidence</button>`:""}
      ${ isAddable?`<button type="button" class="btn btn-success" 
        name="create-bar-${0,i}" id="create-bar-${0,i}-${0,k}" style=" height:30px; padding-top:4px;" ${isExample? "disabled":""} > Click here to <font size="3"><b>Add one more</b></font> video evidence</button>`:""}
    </div>
    `);
  }

  function insertBarElement(i, k, isExample){
    const isDeletable = k > 0;
    const isAddable = Array.from($(`[name="video-bar-${0, i}"]`)).length <= 3;
    createBarElement(i, k, isExample, isDeletable, isAddable).appendTo(`#video-bars-${0,i}`);
    $(`#create-bar-${0,i}-${0,k}`).click(() => {
      const $videobarsarray = Array.from($(`[name="video-bar-${0, i}"]`));
      insertBarElement(i,parseInt($videobarsarray[$videobarsarray.length-1].id.split("-")[3]) + 1, isExample);
      document.getElementById(`create-bar-${0,i}-${0,k}`).disabled = true;
      checkValidationAlerts(i);
      });
    $(`#delete-bar-${0,i}-${0,k}`).click(() => {
      if (confirm(`Do you really want to delete this video evidence?`)==true){
        const $createbarsarray = Array.from($(`[name="create-bar-${0,i}"]`));
        if($createbarsarray[$createbarsarray.length-1].id.split("-")[3] == k){ // delete last addable bar
          $createbarsarray[$createbarsarray.length-2].disabled = false;
          // document.getElementById(`create-bar-${0,i}-${0,$toactk}`).disabled = false;
        }
        else{
          if($createbarsarray[$createbarsarray.length-1].disabled == true){ // activate last addable bar
            $createbarsarray[$createbarsarray.length-1].disabled = false;
          }
        }

        const obj =  document.getElementById(`video-bar-${0,i}-${0,k}`);
        const objparent = obj.parentNode;
        objparent.removeChild(obj);
      }
      checkValidationAlerts(i);
    });
    setUpVideoListeners();
  }

  function createInstances() {
    videos.forEach((video, i) => {
      const isExample = i === 0;
      const title = isExample ? "Example" : `Blank ${0, i}`;
      const parentId = isExample ? "example" : "instances";
      const showNextButton = !isExample && i < videos.length - 1;
      createInstanceElement(i, isExample, title, video, descriptions[i], showNextButton).appendTo(`#${0, parentId}`);
      insertBarElement(i, 0, isExample);
      if (showNextButton) {
        $(`#next-instance-${0, i}`).click(() => {
          window.location.href = `#instance-${0, i + 1}`;
        });
      }
    });
  }

  function collapseInstructions() {
    $("#instructions").removeAttr("open");
    window.location = "#top";
  }

  function questionCompleted(i) {
    const i_value = document.getElementById(`question-input-${0,i}`).value;
    return i_value != null && i_value != "";
  }

  function basedCompleted(i){
    return $(`[name="question-based-${0,i}"]:checked`).length > 0;
  }

  function howCompleted(i) {
    return $(`[name="how-${0,i}"]:checked`).length > 0;
  }

  function correctansCompleted(i) {
    const c_value = document.getElementById(`correct-answer-${0, i}`).value;
    return c_value != null && c_value != "";
  }

  function confidenceCompleted(i) {
    return $(`[name="confidence-${0,i}"]:checked`).length > 0;
  }

  function evidenceCompleted(i,k) {
    const $startbar_value = parseFloat(document.getElementById(`start-bar-${0, i}-${0, k}`).value);
    const $endbar_value = parseFloat(document.getElementById(`end-bar-${0, i}-${0, k}`).value);
    return ($endbar_value > 0) && ($startbar_value <= $endbar_value);
  }

  function evidencesCompleted(i) {
    return Array.from($(`[name="video-bar-${0, i}"]`)).map((eveele,) => {
      const k = eveele.id.split("-")[3];
      return evidenceCompleted(i,k);
    }).every(Boolean);
  }

  function blankCompleted(i) {
    return  questionCompleted(i) && basedCompleted(i) && howCompleted(i) && correctansCompleted(i) &&
      confidenceCompleted(i) && evidencesCompleted(i);
  }

  function checkValid() {
    const completed = videos.map((_, i) => {
      const completi = blankCompleted(i);
      const message1 = "Please type into your question.";
      const message2 = "Please choose at least one option."
      const message3 = "Please choose at least one option.";
      const message4 = "Please provide your correct answer.";
      const message5 = "Please select your confidence level for your correct answer."
      const message6 = "Please finish the video evidence part.\nMake sure the end time > 0.\nMake sure the end time >= the start time.";
      document.getElementById(`question-input-${0, i}`).setCustomValidity(questionCompleted(i)? "" : message1);
      document.getElementById(`question-based-scene-${0, i}`).setCustomValidity(basedCompleted(i)? "" : message2);
      document.getElementById(`how-motion-${0, i}`).setCustomValidity(howCompleted(i)? "" : message3);
      document.getElementById(`correct-answer-${0, i}`).setCustomValidity(correctansCompleted(i)? "" : message4);
      document.getElementById(`confidence-high-${0,i}`).setCustomValidity(confidenceCompleted(i)? "" : message5);
      Array.from($(`[name="video-bar-${0, i}"]`)).map((eveele,) => {
        const k = eveele.id.split("-")[3];
        document.getElementById(`start-bar-${0, i}-${0, k}`).setCustomValidity(evidenceCompleted(i, k)? "" : message6);
      });
      return completi;
    }).every(Boolean);

    document.getElementsByTagName("form")[0].reportValidity();

    return completed;
  }

  function checkValidationAlerts(i) {
    const $errorMessage = $(`#alert-${0, i}`);
    if (blankCompleted(i)) {
      $errorMessage.fadeOut("fast");
    } else {
      $errorMessage.text("Please finish above fill-in and classification tasks.").fadeIn();
    }
  }

  function setUpInputListeners() 
  {
    videos.forEach((_, i) => {
      $(`[name="question-input-${0, i}"]`).keyup(e => 
        {
          if (e.keyCode != ENTER_KEY_CODE && e.keyCode != BACKSPACE_KEY_CODE){
            document.getElementById(`question-input-${0, i}`).setCustomValidity("");
            $(document.getElementById(`question-input-${0, i}`)).removeClass("is-invalid");
          }
          checkValidationAlerts(i);
        });

      Array.from($(`[name="question-based-${0, i}"]`)).forEach(rease => 
      { $(rease).click(e => 
        {
          document.getElementById(`question-based-scene-${0, i}`).setCustomValidity("");
          $(document.getElementById(`question-based-scene-${0, i}`)).removeClass("is-invalid");
          checkValidationAlerts(i);
        });
      });

      Array.from($(`[name="how-${0, i}"]`)).forEach(rease => 
      { $(rease).click(e => 
        {
          document.getElementById(`how-motion-${0, i}`).setCustomValidity("");
          $(document.getElementById(`how-motion-${0, i}`)).removeClass("is-invalid");
          checkValidationAlerts(i);
        });
      });

      $(`[name="correct-answer-${0, i}"]`).keyup(e => 
        {
          if (e.keyCode != ENTER_KEY_CODE && e.keyCode != BACKSPACE_KEY_CODE){
            document.getElementById(`correct-answer-${0, i}`).setCustomValidity("");
            $(document.getElementById(`correct-answer-${0, i}`)).removeClass("is-invalid");
          }
          checkValidationAlerts(i);
        });

      Array.from($(`[name="confidence-${0, i}"]`)).forEach(rease => 
      { $(rease).click(e => 
        {
          document.getElementById(`confidence-high-${0, i}`).setCustomValidity("");
          $(document.getElementById(`confidence-high-${0, i}`)).removeClass("is-invalid");
          checkValidationAlerts(i);
        });
      });

      checkValidationAlerts(i);
    });
  }

  function setUpVideoListeners() {
    videos.forEach((_, i) => {
      return Array.from($(`[name="video-bar-${0, i}"]`)).map((eveele,) => {
        const k = eveele.id.split("-")[3];
        const $videoi = document.getElementById(`refer-video-${0, i}`);
        const $startbari = document.getElementById(`start-bar-${0, i}-${0, k}`);
        const $endbari = document.getElementById(`end-bar-${0, i}-${0, k}`);

        $($startbari).mousedown(e =>{
          $videoi.pause();
          $startbari.setCustomValidity("");
          $($startbari).removeClass("is-invalid");
          $startbari.onmousemove=function(){
            $videoi.currentTime = parseFloat($startbari.value) / 100 * parseFloat($videoi.duration);
          }
          $startbari.onmouseup=function(){
            $videoi.currentTime = parseFloat($startbari.value) / 100 * parseFloat($videoi.duration);
            checkValidationAlerts(i);
            $startbari.onmouseup=null;
            $startbari.onmousemove=null;
          }
          checkValidationAlerts(i);
        });
        $($startbari).keydown(e => {
          if (e.keyCode === 37 || e.keyCode === 39){
            $videoi.currentTime = parseFloat($startbari.value) / 100 * parseFloat($videoi.duration);
            $startbari.setCustomValidity("");
            $($startbari).removeClass("is-invalid");
          }
          checkValidationAlerts(i);
        });
      
        $($endbari).mousedown(e =>{
          $videoi.pause();
          $startbari.setCustomValidity("");
          $($startbari).removeClass("is-invalid");
          $endbari.onmousemove=function(){
            $videoi.currentTime = parseFloat($endbari.value) / 100 * parseFloat($videoi.duration);
          }
          $endbari.onmouseup=function(){
            $videoi.currentTime = parseFloat($endbari.value) / 100 * parseFloat($videoi.duration);
            checkValidationAlerts(i);
            $endbari.onmousemove=null;
            $endbari.onmouseup=null;
          }
          checkValidationAlerts(i);
        });
        $($endbari).keydown(e => {
          if (e.keyCode === 37 || e.keyCode === 39){
            $videoi.currentTime = parseFloat($endbari.value) / 100 * parseFloat($videoi.duration);
            $startbari.setCustomValidity("");
            $($startbari).removeClass("is-invalid");
          }
          checkValidationAlerts(i);
        });
      });
    });
  }

  function onDomContentLoaded() {
    createInstances();
    setUpInputListeners();
    setUpVideoListeners();
  }

  function main() {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", onDomContentLoaded);
    } else {
      onDomContentLoaded();
    }
  }

  main();
</script>
